<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="author" content="[Natalie Schultz]">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Museum Cart</title>
    <style>
        /* minimal on-page styles for clarity; move to your CSS later if you want */
        main {
            max-width: 720px;
            margin: 0 auto;
            padding: 16px;
        }

        .controls {
            margin: 8px 0 12px;
        }

        .empty {
            padding: 12px;
            border: 1px dashed #666;
            font-style: italic;
        }

        pre#summary {
            background: #f8f8f8;
            padding: 12px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            font-feature-settings: "tnum"; /* Tabular numbers for equal width digits */
            -moz-font-feature-settings: "tnum";
            -webkit-font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
            display: grid;
            grid-template-columns: auto min-content;
        }

        .label {
            text-align: left;
        }

        .value {
            text-align: right;
        }

        .actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
        }

        th, td {
            padding: 15px
        }

        .thumbnail {
            width: 120px
        }
    </style>
</head>
<body>
  <header>
    <h1>Shopping Cart</h1>
  </header>

  <main>
    <!-- NEW CONTROLS (Cart page only) -->
    <div class="controls">
      <label><input type="checkbox" id="memberToggle"> Member Discount (15%)</label>
    </div>

    <!-- STATES & OUTPUT AREAS -->
    <div id="emptyMsg" class="empty" hidden>Your cart is empty.</div>
    <div id="items" hidden></div>
    <pre id="summary" hidden></pre>

    <!-- BASIC ACTIONS -->
    <div class="actions">
      <button id="clearBtn">Clear Cart</button>
      <button onclick="location.href='souvenir_shop.html'">Keep shopping</button>
    </div>
  </main>

  <script>
      /* =================== PIPE FROM shop.html (leave as-is) =================== */
      // shop.html must write items with: data-id, data-name, data-price, data-image
      // addToCart(btn) should push objects { id, name, unitPrice, qty, image } to localStorage

      const CART_KEY = 'museumCartV1'; // MUST match shop.html

      function readCart() {
          try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
          catch { return []; }
      }
      function writeCart(cart) {
          localStorage.setItem(CART_KEY, JSON.stringify(cart));
      }
      /* ================= END PIPE ============================================= */


      /* ====================== UTILITIES & CONSTANTS =========================== */
      // Currency with parentheses for negatives
      function money(n) {
          const sign = n < 0 ? -1 : 1;
          const s = '$' + Math.abs(n).toFixed(2);
          return sign < 0 ? '(' + s + ')' : s;
      }

      // Spec constants
      const TAX_RATE = 0.102;
      const MEMBER_DISCOUNT_RATE = 0.15;
      const SHIPPING_RATE = 25.00;
      const VOLUME_TIERS = [
          [0.00, 49.99, 0.00],
          [50.00, 99.99, 0.05],
          [100.00, 199.99, 0.10],
          [200.00, Infinity, 0.15]
      ];

      // Return the volume discount rate given an item total
      function volumeRate(total) {
          for (const [min, max, rate] of VOLUME_TIERS) {
              if (total >= min && total <= max) return rate;
          }
          return 0;
      }

      // Remove a line item entirely (qty=0 => drop row)
      function removeItem(id) {
          const next = readCart().filter(it => it.id !== id);
          writeCart(next);
          render();
      }

      // Clear cart = initial state (cart empty, member unchecked)
      function clearCart() {
          writeCart([]);
          document.getElementById('memberToggle').checked = false;
          render();
      }
      /* ================== END UTILITIES & CONSTANTS =========================== */


      /* ====================== STUDENT WORK STARTS HERE =========================
         IMPLEMENT render() to mirror the commission assignment:

         1) Load cart from readCart(); keep only items with qty > 0 and unitPrice > 0
         2) If empty → show #emptyMsg and hide #items and #summary
         3) Build a text-only list in #items:
               Example line: "2 × Celestial Inkstone               $29.90"
               Include a small Remove button per line that calls removeItem(id)
         4) Math (single-discount rule):
               ItemTotal = sum(unitPrice * qty)
               If Member checked AND Volume tier would apply → PROMPT user to choose:
                 "Only one discount may be applied. Type 'M' for Member or 'V' for Volume:"
                 Apply only the chosen one; set the other to $0.00
               Else apply Member OR Volume (not both)
               Subtotal = ItemTotal − AppliedDiscount + SHIPPING_RATE
               TaxAmount = Subtotal * TAX_RATE
               InvoiceTotal = Subtotal + TaxAmount
         5) Write a single summary block to #summary (like commission):
               Subtotal of Items
               Volume Discount
               Member Discount
               Shipping
               Subtotal (Taxable)
               Tax Rate %   (as a percentage text)
               Tax Amount $ (as currency)
               Invoice Total
         6) Recompute (call render()) after:
               - Member checkbox change
               - Clear Cart
               - Remove line item

         KEEP IT SIMPLE: text output only, one render pass.
      ========================================================================= */

      function render() {
          const itemsDiv = document.getElementById('items');
          const summaryPre = document.getElementById('summary');
          const emptyMsg = document.getElementById('emptyMsg');
          const isMember = document.getElementById('memberToggle').checked;

          // TODO: STUDENT IMPLEMENTATION
          // For now, show a placeholder so the page isn't blank.
          itemsDiv.hidden = true;
          summaryPre.hidden = false;
          emptyMsg.hidden = true;
        
          // Note: You can use console.log() to debug your code in the browser console.
          //       Use the "Elements" tab to inspect the DOM and see your output.
          //       Use the "Application" tab to view localStorage contents.
          let itemList = []
          itemList.push(`<table>
                                          <thead>
                                <th>Product image</th>
                                <th>Quantity</th>
                                <th>Name</th>
                                <th></th>
                                <th>Price</th>
                                <th>Line Total</th>
                                
                                </thead > `)
          // Example of how to access cart items:
          const cart = readCart();
          console.log(cart); // Check what items are in the cart
          let subTotal = 0;
          cart.forEach(item => {
              const itemTotal = item.unitPrice * item.qty;
              subTotal += itemTotal;
              itemList.push(`<tr>
                                <td><img src="`+ item.image + `" alt="` + item.name + `" class="thumbnail"></td>
                                <td>` + item.qty + `</td>
                                <td>` + item.name + `</td>
                                <td><button onclick="removeItem('`+ item.id + `')">Remove</button></td>
                                <td>` + money(item.unitPrice) + `</td>
                                 <td>` + money(item.unitPrice * item.qty) + `</td>
                              </tr>`);
          })
          itemList.push(`<tfoot>
                                <td></td>
                                <td></td>
                                <td></td>
                              </tfoot>
                              </table>`)
          itemsDiv.hidden = false;
          itemsDiv.innerHTML = itemList.join("");

          // find volume discount rate
          let volumeDiscountRate = 0;
          for (const [min, max, rate] of VOLUME_TIERS) {
              if (subTotal >= min && subTotal <= max) {
                  volumeDiscountRate = rate;
                  break;
              }
          }
          let volumeDiscountAmount = subTotal * volumeDiscountRate;
          let memberDiscountAmount = isMember ? subTotal * MEMBER_DISCOUNT_RATE : 0;
          if (volumeDiscountRate > 0 && isMember) {
              let choice = prompt(`Only one discount may be applied.` +
                  `M) Member discount (${(MEMBER_DISCOUNT_RATE * 100).toFixed(0)}%)\n` +
                  `V) Volume discount (${(volumeDiscountRate * 100).toFixed(0)}%)\n` +
                  ` Type 'M' for Member or 'V' for Volume:`);
              if (choice && choice.toUpperCase() === 'M') {
                  // Apply member discount
                  volumeDiscountAmount = 0;
              } else if (choice && choice.toUpperCase() === 'V') {
                  // Apply volume discount
                  memberDiscountAmount = 0;
              } else {
                  // Invalid input, apply no discounts
                  volumeDiscountAmount = 0;
                  memberDiscountAmount = 0;
              }
          }
          const taxableSubtotal = subTotal - Math.max(volumeDiscountAmount, memberDiscountAmount) + SHIPPING_RATE;
          const taxAmount = taxableSubtotal * TAX_RATE;
          const invoiceTotal = taxableSubtotal + (taxAmount);

          summaryPre.innerHTML = `<span class="label">Hello Shopper, here's your cart summary:</span><span class="value"></span>\n\n` +
                    `<span class="label">Subtotal of Items: </span><span class="value">${ money(subTotal) } </span>\n` +
              `<span class="label">Volume Discount: </span><span class="value">${money(volumeDiscountAmount) } </span>\n` +
              `<span class="label">Member Discount: </span><span class="value">${money(memberDiscountAmount) } </span>\n` +
              `<span class="label">Shipping: </span><span class="value">${money(SHIPPING_RATE) } </span>\n` +
              `<span class="label">Subtotal(Taxable Amount): </span><span class="value">${money(taxableSubtotal) } </span>\n` +
              `<span class="label">Tax Rate %: </span><span class="value">${(TAX_RATE * 100).toFixed(2) }%</span>\n` +
              `<span class="label">Tax Amount $: </span><span class="value">${money(taxAmount) } </span>\n` +
              `<span class="label">Invoice Total: </span><span class="value">${money(invoiceTotal) } </span>`;
            }

            // Events → re-render
            document.getElementById('memberToggle').addEventListener('change', render);
            document.getElementById('clearBtn').addEventListener('click', clearCart);

            // First paint
            render();
  </script>
</body>
</html>
